<!-- src/app/features/donations/donation-history/donation-history.component.html -->
<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">My Donations</h1>

    @if (loading()) {
    <div class="flex justify-center py-12">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
      ></div>
    </div>
    } @else if (donations().length > 0) {
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Date
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Campaign
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Amount
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Status
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Receipt
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (donation of donations(); track donation.donationId) {
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ donation.donationDate | date : "medium" }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-900">
              <a
                [routerLink]="['/campaigns', donation.campaignId]"
                class="text-blue-600 hover:underline"
              >
                View Campaign
              </a>
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"
            >
              {{ donation.displayCurrency }}
              {{ donation.displayAmount | number : "1.2-2" }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                [class]="getStatusClass(donation.status)"
                class="px-2 py-1 text-xs font-semibold rounded-full"
              >
                {{ donation.status }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <!-- Show confirm button only if PENDING with sessionId -->
              <ng-container
                *ngIf="
                  donation.status === 'PENDING' && donation.paymentSessionId;
                  else receiptLink
                "
              >
                <button
                  (click)="confirmPendingPayment(donation)"
                  [disabled]="confirmingSessionId === donation.paymentSessionId"
                  class="px-3 py-1 text-sm bg-yellow-400 hover:bg-yellow-500 text-white rounded"
                >
                  {{
                    confirmingSessionId === donation.paymentSessionId
                      ? "Confirming..."
                      : "Confirm Payment"
                  }}
                </button>
              </ng-container>

              <ng-template #receiptLink>
                <ng-container *ngIf="donation.receiptUrl; else noReceipt">
                  <a
                    href="{{ donation.receiptUrl }}"
                    target="_blank"
                    class="text-blue-600 hover:underline"
                  >
                    View Receipt
                  </a>
                </ng-container>
                <ng-template #noReceipt>
                  <span class="text-gray-400">N/A</span>
                </ng-template>
              </ng-template>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <div class="text-center py-12 bg-white rounded-lg shadow-md">
      <svg
        class="mx-auto h-12 w-12 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        ></path>
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900">No donations yet</h3>
      <p class="mt-1 text-gray-500">
        Start supporting campaigns to see your donation history here.
      </p>
      <div class="mt-6">
        <a
          routerLink="/campaigns"
          class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
        >
          Browse Campaigns
        </a>
      </div>
    </div>
    }
  </div>
</div>
